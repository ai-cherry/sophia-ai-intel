"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Flynnmusil%2Fsophia-ai-intel-1%2Fapps%2Fsophia-dashboard%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flynnmusil%2Fsophia-ai-intel-1%2Fapps%2Fsophia-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Flynnmusil%2Fsophia-ai-intel-1%2Fapps%2Fsophia-dashboard%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flynnmusil%2Fsophia-ai-intel-1%2Fapps%2Fsophia-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_lynnmusil_sophia_ai_intel_1_apps_sophia_dashboard_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/chat/route.ts */ \"(rsc)/./app/api/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    resolvedPagePath: \"/Users/lynnmusil/sophia-ai-intel-1/apps/sophia-dashboard/app/api/chat/route.ts\",\n    nextConfigOutput,\n    userland: _Users_lynnmusil_sophia_ai_intel_1_apps_sophia_dashboard_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGY2hhdCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGY2hhdCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmNoYXQlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZseW5ubXVzaWwlMkZzb3BoaWEtYWktaW50ZWwtMSUyRmFwcHMlMkZzb3BoaWEtZGFzaGJvYXJkJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmx5bm5tdXNpbCUyRnNvcGhpYS1haS1pbnRlbC0xJTJGYXBwcyUyRnNvcGhpYS1kYXNoYm9hcmQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUM4QjtBQUMzRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NvcGhpYS1kYXNoYm9hcmQvPzY0MzAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2x5bm5tdXNpbC9zb3BoaWEtYWktaW50ZWwtMS9hcHBzL3NvcGhpYS1kYXNoYm9hcmQvYXBwL2FwaS9jaGF0L3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY2hhdC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NoYXRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2NoYXQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvbHlubm11c2lsL3NvcGhpYS1haS1pbnRlbC0xL2FwcHMvc29waGlhLWRhc2hib2FyZC9hcHAvYXBpL2NoYXQvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2NoYXQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Flynnmusil%2Fsophia-ai-intel-1%2Fapps%2Fsophia-dashboard%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flynnmusil%2Fsophia-ai-intel-1%2Fapps%2Fsophia-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/chat/route.ts":
/*!*******************************!*\
  !*** ./app/api/chat/route.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   HEAD: () => (/* binding */ HEAD),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/**\n * SOPHIA COMPLETE - One File, One Truth\n * Everything in one place. No bullshit.\n */ \n// API Provider Configuration\nconst API_KEYS = {\n    perplexity: process.env.PERPLEXITY_API_KEY || \"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\",\n    tavily: process.env.TAVILY_API_KEY || \"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\",\n    openrouter: process.env.OPENROUTER_API_KEY || \"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\",\n    brave: process.env.BRAVE_API_KEY || \"BSApz0194z7SG6DplmVozl7ttFOi0Eo\",\n    openai: process.env.OPENAI_API_KEY,\n    anthropic: process.env.ANTHROPIC_API_KEY\n};\n// In-memory session storage (replace with Redis in production)\nconst sessions = new Map();\nclass SophiaCore {\n    /**\n   * Classify query intent\n   */ classifyQuery(query) {\n        const q = query.toLowerCase();\n        if (/\\b(code|github|repo|library|npm|pip|framework|api)\\b/.test(q)) return \"code\";\n        if (/\\b(search|find|research|latest|news|current)\\b/.test(q)) return \"research\";\n        if (/\\b(who|what|when|where|why|how|explain)\\b/.test(q)) return \"knowledge\";\n        if (/\\b(build|create|implement|design|plan)\\b/.test(q)) return \"planning\";\n        if (/\\b(analyze|compare|evaluate|assess)\\b/.test(q)) return \"analysis\";\n        return \"general\";\n    }\n    /**\n   * Call Perplexity for research\n   */ async callPerplexity(query) {\n        if (!API_KEYS.perplexity) return null;\n        try {\n            const response = await fetch(\"https://api.perplexity.ai/chat/completions\", {\n                method: \"POST\",\n                headers: {\n                    \"Authorization\": `Bearer ${API_KEYS.perplexity}`,\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    model: \"sonar-small-chat\",\n                    messages: [\n                        {\n                            role: \"user\",\n                            content: query\n                        }\n                    ]\n                })\n            });\n            if (response.ok) {\n                const data = await response.json();\n                return data.choices?.[0]?.message?.content || null;\n            }\n        } catch (e) {\n            console.error(\"Perplexity error:\", e);\n        }\n        return null;\n    }\n    /**\n   * Call Tavily for web search\n   */ async callTavily(query) {\n        if (!API_KEYS.tavily) return null;\n        try {\n            const response = await fetch(\"https://api.tavily.com/search\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    api_key: API_KEYS.tavily,\n                    query: query,\n                    search_depth: \"advanced\",\n                    max_results: 3\n                })\n            });\n            if (response.ok) {\n                const data = await response.json();\n                if (data.answer || data.results) {\n                    let result = data.answer || \"\";\n                    if (data.results?.length) {\n                        result += \"\\n\\nSources:\\n\" + data.results.slice(0, 3).map((r)=>`- ${r.title}: ${r.url}`).join(\"\\n\");\n                    }\n                    return result;\n                }\n            }\n        } catch (e) {\n            console.error(\"Tavily error:\", e);\n        }\n        return null;\n    }\n    /**\n   * Call OpenRouter for LLM access\n   */ async callOpenRouter(query, model = \"anthropic/claude-3-haiku\") {\n        if (!API_KEYS.openrouter) return null;\n        try {\n            const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\n                method: \"POST\",\n                headers: {\n                    \"Authorization\": `Bearer ${API_KEYS.openrouter}`,\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    model: model,\n                    messages: [\n                        {\n                            role: \"user\",\n                            content: query\n                        }\n                    ]\n                })\n            });\n            if (response.ok) {\n                const data = await response.json();\n                return data.choices?.[0]?.message?.content || null;\n            }\n        } catch (e) {\n            console.error(\"OpenRouter error:\", e);\n        }\n        return null;\n    }\n    /**\n   * Call local MCP services\n   */ async callMCP(query, type) {\n        try {\n            // Try MCP Research for GitHub/code queries\n            if (type === \"code\") {\n                const response = await fetch(`http://localhost:8085/search/github?q=${encodeURIComponent(query)}&limit=3`);\n                if (response.ok) {\n                    const data = await response.json();\n                    if (data.results?.length) {\n                        return data.results.map((r)=>`ðŸ“¦ ${r.title}\\n  ${r.summary}\\n  â­ ${r.metadata?.stars || 0} | ${r.url}`).join(\"\\n\\n\");\n                    }\n                }\n            }\n            // Try general research\n            const researchResponse = await fetch(\"http://localhost:8085/research\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    query,\n                    max_results: 3\n                })\n            });\n            if (researchResponse.ok) {\n                const data = await researchResponse.json();\n                if (data.results?.length) {\n                    return data.results.map((r)=>`- ${r.title}: ${r.summary}`).join(\"\\n\");\n                }\n            }\n        } catch (e) {\n        // MCP not available\n        }\n        return null;\n    }\n    /**\n   * Generate response using best available provider\n   */ async generateResponse(query, sessionId) {\n        const queryType = this.classifyQuery(query);\n        let response = null;\n        let provider = \"none\";\n        // Try providers based on query type\n        if (queryType === \"research\" || queryType === \"knowledge\") {\n            // Try Perplexity first for research\n            response = await this.callPerplexity(query);\n            if (response) provider = \"perplexity\";\n            // Fallback to Tavily\n            if (!response) {\n                response = await this.callTavily(query);\n                if (response) provider = \"tavily\";\n            }\n        }\n        if (queryType === \"code\") {\n            // Try MCP for code searches\n            response = await this.callMCP(query, \"code\");\n            if (response) provider = \"mcp-github\";\n            // Fallback to Tavily\n            if (!response) {\n                response = await this.callTavily(`${query} github repository`);\n                if (response) provider = \"tavily\";\n            }\n        }\n        // For other types or if above failed, try OpenRouter\n        if (!response && queryType !== \"code\") {\n            response = await this.callOpenRouter(query);\n            if (response) provider = \"openrouter\";\n        }\n        // Final fallback to MCP\n        if (!response) {\n            response = await this.callMCP(query, \"general\");\n            if (response) provider = \"mcp-research\";\n        }\n        // Ultimate fallback\n        if (!response) {\n            response = this.getFallbackResponse(query, queryType);\n            provider = \"fallback\";\n        }\n        return {\n            response,\n            provider,\n            metadata: {\n                queryType,\n                sessionId,\n                timestamp: new Date().toISOString()\n            }\n        };\n    }\n    /**\n   * Fallback responses when no API available\n   */ getFallbackResponse(query, queryType) {\n        const responses = {\n            code: `I understand you're looking for code related to \"${query}\". Try searching GitHub directly or check npm/PyPI for packages.`,\n            research: `I'd research \"${query}\" for you, but external services are unavailable. Check recent sources directly.`,\n            knowledge: `Regarding \"${query}\": I can provide general information, though real-time data needs active APIs.`,\n            planning: `I'll help you plan \"${query}\" using architectural best practices and proven patterns.`,\n            analysis: `For analyzing \"${query}\", I'll use my built-in knowledge since external services are unavailable.`,\n            general: `Processing your request about \"${query}\". External services are limited but I'll do my best.`\n        };\n        return responses[queryType] || `I received: \"${query}\". How can I help you today?`;\n    }\n}\n// Initialize Sophia\nconst sophia = new SophiaCore();\n/**\n * Main chat endpoint\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { message, sessionId = \"default\", context = {} } = body;\n        if (!message) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Message required\"\n            }, {\n                status: 400\n            });\n        }\n        // Get or create session\n        if (!sessions.has(sessionId)) {\n            sessions.set(sessionId, []);\n        }\n        const conversation = sessions.get(sessionId);\n        // Add user message\n        conversation.push({\n            role: \"user\",\n            content: message,\n            timestamp: new Date().toISOString()\n        });\n        // Generate response\n        const result = await sophia.generateResponse(message, sessionId);\n        // Add assistant response\n        conversation.push({\n            role: \"assistant\",\n            content: result.response,\n            timestamp: new Date().toISOString(),\n            metadata: result.metadata\n        });\n        // Keep only last 20 messages per session\n        if (conversation.length > 20) {\n            conversation.splice(0, conversation.length - 20);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: result.response,\n            sessionId,\n            provider: result.provider,\n            metadata: result.metadata,\n            conversationLength: conversation.length\n        });\n    } catch (error) {\n        console.error(\"Chat error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * Get conversation history\n */ async function GET(request) {\n    const { searchParams } = new URL(request.url);\n    const sessionId = searchParams.get(\"sessionId\") || \"default\";\n    const conversation = sessions.get(sessionId) || [];\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        sessionId,\n        messages: conversation,\n        total: conversation.length\n    });\n}\n/**\n * Health check\n */ async function HEAD() {\n    return new Response(null, {\n        status: 200\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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OEM7SUFDcEIsT0FBTyxJQUFJQyxTQUFTLE1BQU07UUFBRWIsUUFBUTtJQUFJO0FBQzFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc29waGlhLWRhc2hib2FyZC8uL2FwcC9hcGkvY2hhdC9yb3V0ZS50cz9kZTQ2Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU09QSElBIENPTVBMRVRFIC0gT25lIEZpbGUsIE9uZSBUcnV0aFxuICogRXZlcnl0aGluZyBpbiBvbmUgcGxhY2UuIE5vIGJ1bGxzaGl0LlxuICovXG5cbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxuLy8gVHlwZXNcbmludGVyZmFjZSBNZXNzYWdlIHtcbiAgcm9sZTogJ3VzZXInIHwgJ2Fzc2lzdGFudCcgfCAnc3lzdGVtJztcbiAgY29udGVudDogc3RyaW5nO1xuICB0aW1lc3RhbXA/OiBzdHJpbmc7XG4gIG1ldGFkYXRhPzogYW55O1xufVxuXG5pbnRlcmZhY2UgQ2hhdFJlcXVlc3Qge1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIHNlc3Npb25JZD86IHN0cmluZztcbiAgY29udGV4dD86IGFueTtcbn1cblxuLy8gQVBJIFByb3ZpZGVyIENvbmZpZ3VyYXRpb25cbmNvbnN0IEFQSV9LRVlTID0ge1xuICBwZXJwbGV4aXR5OiBwcm9jZXNzLmVudi5QRVJQTEVYSVRZX0FQSV9LRVkgfHwgJ3BwbHgtWGZwcWp4a0plQjNiejNIbWwwOUNJM09GN1NRWm1CUUhOV2xqdEtzNGVYaTVDc1ZOJyxcbiAgdGF2aWx5OiBwcm9jZXNzLmVudi5UQVZJTFlfQVBJX0tFWSB8fCAndHZseS02S3hQTWZzRWhVMHdITkw3UGNSTjRZRUZNM2VXY1BRZ2dxN2VkRXI1MklkbicsXG4gIG9wZW5yb3V0ZXI6IHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfQVBJX0tFWSB8fCAnc2stb3ItdjEtMWQwOTAwYjMyYWQ0ZTc0MTAyN2I4ZDBmNjM0OTFjYmRhY2Y4MjRjYTVkZDA2ODhkMzljYjg2Y2RmMjMzMmUxZicsXG4gIGJyYXZlOiBwcm9jZXNzLmVudi5CUkFWRV9BUElfS0VZIHx8ICdCU0FwejAxOTR6N1NHNkRwbG1Wb3psN3R0Rk9pMEVvJyxcbiAgb3BlbmFpOiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbiAgYW50aHJvcGljOiBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWSxcbn07XG5cbi8vIEluLW1lbW9yeSBzZXNzaW9uIHN0b3JhZ2UgKHJlcGxhY2Ugd2l0aCBSZWRpcyBpbiBwcm9kdWN0aW9uKVxuY29uc3Qgc2Vzc2lvbnMgPSBuZXcgTWFwPHN0cmluZywgTWVzc2FnZVtdPigpO1xuXG5jbGFzcyBTb3BoaWFDb3JlIHtcbiAgLyoqXG4gICAqIENsYXNzaWZ5IHF1ZXJ5IGludGVudFxuICAgKi9cbiAgcHJpdmF0ZSBjbGFzc2lmeVF1ZXJ5KHF1ZXJ5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHEgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgIFxuICAgIGlmICgvXFxiKGNvZGV8Z2l0aHVifHJlcG98bGlicmFyeXxucG18cGlwfGZyYW1ld29ya3xhcGkpXFxiLy50ZXN0KHEpKSByZXR1cm4gJ2NvZGUnO1xuICAgIGlmICgvXFxiKHNlYXJjaHxmaW5kfHJlc2VhcmNofGxhdGVzdHxuZXdzfGN1cnJlbnQpXFxiLy50ZXN0KHEpKSByZXR1cm4gJ3Jlc2VhcmNoJztcbiAgICBpZiAoL1xcYih3aG98d2hhdHx3aGVufHdoZXJlfHdoeXxob3d8ZXhwbGFpbilcXGIvLnRlc3QocSkpIHJldHVybiAna25vd2xlZGdlJztcbiAgICBpZiAoL1xcYihidWlsZHxjcmVhdGV8aW1wbGVtZW50fGRlc2lnbnxwbGFuKVxcYi8udGVzdChxKSkgcmV0dXJuICdwbGFubmluZyc7XG4gICAgaWYgKC9cXGIoYW5hbHl6ZXxjb21wYXJlfGV2YWx1YXRlfGFzc2VzcylcXGIvLnRlc3QocSkpIHJldHVybiAnYW5hbHlzaXMnO1xuICAgIFxuICAgIHJldHVybiAnZ2VuZXJhbCc7XG4gIH1cblxuICAvKipcbiAgICogQ2FsbCBQZXJwbGV4aXR5IGZvciByZXNlYXJjaFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjYWxsUGVycGxleGl0eShxdWVyeTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgaWYgKCFBUElfS0VZUy5wZXJwbGV4aXR5KSByZXR1cm4gbnVsbDtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkucGVycGxleGl0eS5haS9jaGF0L2NvbXBsZXRpb25zJywge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke0FQSV9LRVlTLnBlcnBsZXhpdHl9YCxcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBtb2RlbDogJ3NvbmFyLXNtYWxsLWNoYXQnLFxuICAgICAgICAgIG1lc3NhZ2VzOiBbeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHF1ZXJ5IH1dXG4gICAgICAgIH0pXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIHJldHVybiBkYXRhLmNob2ljZXM/LlswXT8ubWVzc2FnZT8uY29udGVudCB8fCBudWxsO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1BlcnBsZXhpdHkgZXJyb3I6JywgZSk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGwgVGF2aWx5IGZvciB3ZWIgc2VhcmNoXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNhbGxUYXZpbHkocXVlcnk6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIGlmICghQVBJX0tFWVMudGF2aWx5KSByZXR1cm4gbnVsbDtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkudGF2aWx5LmNvbS9zZWFyY2gnLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGFwaV9rZXk6IEFQSV9LRVlTLnRhdmlseSxcbiAgICAgICAgICBxdWVyeTogcXVlcnksXG4gICAgICAgICAgc2VhcmNoX2RlcHRoOiAnYWR2YW5jZWQnLFxuICAgICAgICAgIG1heF9yZXN1bHRzOiAzXG4gICAgICAgIH0pXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmIChkYXRhLmFuc3dlciB8fCBkYXRhLnJlc3VsdHMpIHtcbiAgICAgICAgICBsZXQgcmVzdWx0ID0gZGF0YS5hbnN3ZXIgfHwgJyc7XG4gICAgICAgICAgaWYgKGRhdGEucmVzdWx0cz8ubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gJ1xcblxcblNvdXJjZXM6XFxuJyArIGRhdGEucmVzdWx0cy5zbGljZSgwLCAzKS5tYXAoKHI6IGFueSkgPT4gXG4gICAgICAgICAgICAgIGAtICR7ci50aXRsZX06ICR7ci51cmx9YFxuICAgICAgICAgICAgKS5qb2luKCdcXG4nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1RhdmlseSBlcnJvcjonLCBlKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQ2FsbCBPcGVuUm91dGVyIGZvciBMTE0gYWNjZXNzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNhbGxPcGVuUm91dGVyKHF1ZXJ5OiBzdHJpbmcsIG1vZGVsID0gJ2FudGhyb3BpYy9jbGF1ZGUtMy1oYWlrdScpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICBpZiAoIUFQSV9LRVlTLm9wZW5yb3V0ZXIpIHJldHVybiBudWxsO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxL2NoYXQvY29tcGxldGlvbnMnLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7QVBJX0tFWVMub3BlbnJvdXRlcn1gLFxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIG1vZGVsOiBtb2RlbCxcbiAgICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogJ3VzZXInLCBjb250ZW50OiBxdWVyeSB9XVxuICAgICAgICB9KVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICByZXR1cm4gZGF0YS5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgfHwgbnVsbDtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdPcGVuUm91dGVyIGVycm9yOicsIGUpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsIGxvY2FsIE1DUCBzZXJ2aWNlc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjYWxsTUNQKHF1ZXJ5OiBzdHJpbmcsIHR5cGU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBUcnkgTUNQIFJlc2VhcmNoIGZvciBHaXRIdWIvY29kZSBxdWVyaWVzXG4gICAgICBpZiAodHlwZSA9PT0gJ2NvZGUnKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6ODA4NS9zZWFyY2gvZ2l0aHViP3E9JHtlbmNvZGVVUklDb21wb25lbnQocXVlcnkpfSZsaW1pdD0zYCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgaWYgKGRhdGEucmVzdWx0cz8ubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS5yZXN1bHRzLm1hcCgocjogYW55KSA9PiBcbiAgICAgICAgICAgICAgYPCfk6YgJHtyLnRpdGxlfVxcbiAgJHtyLnN1bW1hcnl9XFxuICDirZAgJHtyLm1ldGFkYXRhPy5zdGFycyB8fCAwfSB8ICR7ci51cmx9YFxuICAgICAgICAgICAgKS5qb2luKCdcXG5cXG4nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVHJ5IGdlbmVyYWwgcmVzZWFyY2hcbiAgICAgIGNvbnN0IHJlc2VhcmNoUmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDo4MDg1L3Jlc2VhcmNoJywge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgcXVlcnksIG1heF9yZXN1bHRzOiAzIH0pXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKHJlc2VhcmNoUmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc2VhcmNoUmVzcG9uc2UuanNvbigpO1xuICAgICAgICBpZiAoZGF0YS5yZXN1bHRzPy5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gZGF0YS5yZXN1bHRzLm1hcCgocjogYW55KSA9PiBgLSAke3IudGl0bGV9OiAke3Iuc3VtbWFyeX1gKS5qb2luKCdcXG4nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIE1DUCBub3QgYXZhaWxhYmxlXG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIHJlc3BvbnNlIHVzaW5nIGJlc3QgYXZhaWxhYmxlIHByb3ZpZGVyXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZVJlc3BvbnNlKHF1ZXJ5OiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgcmVzcG9uc2U6IHN0cmluZztcbiAgICBwcm92aWRlcjogc3RyaW5nO1xuICAgIG1ldGFkYXRhOiBhbnk7XG4gIH0+IHtcbiAgICBjb25zdCBxdWVyeVR5cGUgPSB0aGlzLmNsYXNzaWZ5UXVlcnkocXVlcnkpO1xuICAgIGxldCByZXNwb25zZSA9IG51bGw7XG4gICAgbGV0IHByb3ZpZGVyID0gJ25vbmUnO1xuICAgIFxuICAgIC8vIFRyeSBwcm92aWRlcnMgYmFzZWQgb24gcXVlcnkgdHlwZVxuICAgIGlmIChxdWVyeVR5cGUgPT09ICdyZXNlYXJjaCcgfHwgcXVlcnlUeXBlID09PSAna25vd2xlZGdlJykge1xuICAgICAgLy8gVHJ5IFBlcnBsZXhpdHkgZmlyc3QgZm9yIHJlc2VhcmNoXG4gICAgICByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2FsbFBlcnBsZXhpdHkocXVlcnkpO1xuICAgICAgaWYgKHJlc3BvbnNlKSBwcm92aWRlciA9ICdwZXJwbGV4aXR5JztcbiAgICAgIFxuICAgICAgLy8gRmFsbGJhY2sgdG8gVGF2aWx5XG4gICAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jYWxsVGF2aWx5KHF1ZXJ5KTtcbiAgICAgICAgaWYgKHJlc3BvbnNlKSBwcm92aWRlciA9ICd0YXZpbHknO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBpZiAocXVlcnlUeXBlID09PSAnY29kZScpIHtcbiAgICAgIC8vIFRyeSBNQ1AgZm9yIGNvZGUgc2VhcmNoZXNcbiAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jYWxsTUNQKHF1ZXJ5LCAnY29kZScpO1xuICAgICAgaWYgKHJlc3BvbnNlKSBwcm92aWRlciA9ICdtY3AtZ2l0aHViJztcbiAgICAgIFxuICAgICAgLy8gRmFsbGJhY2sgdG8gVGF2aWx5XG4gICAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jYWxsVGF2aWx5KGAke3F1ZXJ5fSBnaXRodWIgcmVwb3NpdG9yeWApO1xuICAgICAgICBpZiAocmVzcG9uc2UpIHByb3ZpZGVyID0gJ3RhdmlseSc7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIEZvciBvdGhlciB0eXBlcyBvciBpZiBhYm92ZSBmYWlsZWQsIHRyeSBPcGVuUm91dGVyXG4gICAgaWYgKCFyZXNwb25zZSAmJiBxdWVyeVR5cGUgIT09ICdjb2RlJykge1xuICAgICAgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNhbGxPcGVuUm91dGVyKHF1ZXJ5KTtcbiAgICAgIGlmIChyZXNwb25zZSkgcHJvdmlkZXIgPSAnb3BlbnJvdXRlcic7XG4gICAgfVxuICAgIFxuICAgIC8vIEZpbmFsIGZhbGxiYWNrIHRvIE1DUFxuICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jYWxsTUNQKHF1ZXJ5LCAnZ2VuZXJhbCcpO1xuICAgICAgaWYgKHJlc3BvbnNlKSBwcm92aWRlciA9ICdtY3AtcmVzZWFyY2gnO1xuICAgIH1cbiAgICBcbiAgICAvLyBVbHRpbWF0ZSBmYWxsYmFja1xuICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgIHJlc3BvbnNlID0gdGhpcy5nZXRGYWxsYmFja1Jlc3BvbnNlKHF1ZXJ5LCBxdWVyeVR5cGUpO1xuICAgICAgcHJvdmlkZXIgPSAnZmFsbGJhY2snO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgcmVzcG9uc2UsXG4gICAgICBwcm92aWRlcixcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIHF1ZXJ5VHlwZSxcbiAgICAgICAgc2Vzc2lvbklkLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRmFsbGJhY2sgcmVzcG9uc2VzIHdoZW4gbm8gQVBJIGF2YWlsYWJsZVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRGYWxsYmFja1Jlc3BvbnNlKHF1ZXJ5OiBzdHJpbmcsIHF1ZXJ5VHlwZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCByZXNwb25zZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgICBjb2RlOiBgSSB1bmRlcnN0YW5kIHlvdSdyZSBsb29raW5nIGZvciBjb2RlIHJlbGF0ZWQgdG8gXCIke3F1ZXJ5fVwiLiBUcnkgc2VhcmNoaW5nIEdpdEh1YiBkaXJlY3RseSBvciBjaGVjayBucG0vUHlQSSBmb3IgcGFja2FnZXMuYCxcbiAgICAgIHJlc2VhcmNoOiBgSSdkIHJlc2VhcmNoIFwiJHtxdWVyeX1cIiBmb3IgeW91LCBidXQgZXh0ZXJuYWwgc2VydmljZXMgYXJlIHVuYXZhaWxhYmxlLiBDaGVjayByZWNlbnQgc291cmNlcyBkaXJlY3RseS5gLFxuICAgICAga25vd2xlZGdlOiBgUmVnYXJkaW5nIFwiJHtxdWVyeX1cIjogSSBjYW4gcHJvdmlkZSBnZW5lcmFsIGluZm9ybWF0aW9uLCB0aG91Z2ggcmVhbC10aW1lIGRhdGEgbmVlZHMgYWN0aXZlIEFQSXMuYCxcbiAgICAgIHBsYW5uaW5nOiBgSSdsbCBoZWxwIHlvdSBwbGFuIFwiJHtxdWVyeX1cIiB1c2luZyBhcmNoaXRlY3R1cmFsIGJlc3QgcHJhY3RpY2VzIGFuZCBwcm92ZW4gcGF0dGVybnMuYCxcbiAgICAgIGFuYWx5c2lzOiBgRm9yIGFuYWx5emluZyBcIiR7cXVlcnl9XCIsIEknbGwgdXNlIG15IGJ1aWx0LWluIGtub3dsZWRnZSBzaW5jZSBleHRlcm5hbCBzZXJ2aWNlcyBhcmUgdW5hdmFpbGFibGUuYCxcbiAgICAgIGdlbmVyYWw6IGBQcm9jZXNzaW5nIHlvdXIgcmVxdWVzdCBhYm91dCBcIiR7cXVlcnl9XCIuIEV4dGVybmFsIHNlcnZpY2VzIGFyZSBsaW1pdGVkIGJ1dCBJJ2xsIGRvIG15IGJlc3QuYFxuICAgIH07XG4gICAgXG4gICAgcmV0dXJuIHJlc3BvbnNlc1txdWVyeVR5cGVdIHx8IGBJIHJlY2VpdmVkOiBcIiR7cXVlcnl9XCIuIEhvdyBjYW4gSSBoZWxwIHlvdSB0b2RheT9gO1xuICB9XG59XG5cbi8vIEluaXRpYWxpemUgU29waGlhXG5jb25zdCBzb3BoaWEgPSBuZXcgU29waGlhQ29yZSgpO1xuXG4vKipcbiAqIE1haW4gY2hhdCBlbmRwb2ludFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keTogQ2hhdFJlcXVlc3QgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIHNlc3Npb25JZCA9ICdkZWZhdWx0JywgY29udGV4dCA9IHt9IH0gPSBib2R5O1xuICAgIFxuICAgIGlmICghbWVzc2FnZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTWVzc2FnZSByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBHZXQgb3IgY3JlYXRlIHNlc3Npb25cbiAgICBpZiAoIXNlc3Npb25zLmhhcyhzZXNzaW9uSWQpKSB7XG4gICAgICBzZXNzaW9ucy5zZXQoc2Vzc2lvbklkLCBbXSk7XG4gICAgfVxuICAgIGNvbnN0IGNvbnZlcnNhdGlvbiA9IHNlc3Npb25zLmdldChzZXNzaW9uSWQpITtcbiAgICBcbiAgICAvLyBBZGQgdXNlciBtZXNzYWdlXG4gICAgY29udmVyc2F0aW9uLnB1c2goe1xuICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgY29udGVudDogbWVzc2FnZSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfSk7XG4gICAgXG4gICAgLy8gR2VuZXJhdGUgcmVzcG9uc2VcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzb3BoaWEuZ2VuZXJhdGVSZXNwb25zZShtZXNzYWdlLCBzZXNzaW9uSWQpO1xuICAgIFxuICAgIC8vIEFkZCBhc3Npc3RhbnQgcmVzcG9uc2VcbiAgICBjb252ZXJzYXRpb24ucHVzaCh7XG4gICAgICByb2xlOiAnYXNzaXN0YW50JyxcbiAgICAgIGNvbnRlbnQ6IHJlc3VsdC5yZXNwb25zZSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgbWV0YWRhdGE6IHJlc3VsdC5tZXRhZGF0YVxuICAgIH0pO1xuICAgIFxuICAgIC8vIEtlZXAgb25seSBsYXN0IDIwIG1lc3NhZ2VzIHBlciBzZXNzaW9uXG4gICAgaWYgKGNvbnZlcnNhdGlvbi5sZW5ndGggPiAyMCkge1xuICAgICAgY29udmVyc2F0aW9uLnNwbGljZSgwLCBjb252ZXJzYXRpb24ubGVuZ3RoIC0gMjApO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgbWVzc2FnZTogcmVzdWx0LnJlc3BvbnNlLFxuICAgICAgc2Vzc2lvbklkLFxuICAgICAgcHJvdmlkZXI6IHJlc3VsdC5wcm92aWRlcixcbiAgICAgIG1ldGFkYXRhOiByZXN1bHQubWV0YWRhdGEsXG4gICAgICBjb252ZXJzYXRpb25MZW5ndGg6IGNvbnZlcnNhdGlvbi5sZW5ndGhcbiAgICB9KTtcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdDaGF0IGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBjb252ZXJzYXRpb24gaGlzdG9yeVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuICBjb25zdCBzZXNzaW9uSWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdzZXNzaW9uSWQnKSB8fCAnZGVmYXVsdCc7XG4gIFxuICBjb25zdCBjb252ZXJzYXRpb24gPSBzZXNzaW9ucy5nZXQoc2Vzc2lvbklkKSB8fCBbXTtcbiAgXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgc2Vzc2lvbklkLFxuICAgIG1lc3NhZ2VzOiBjb252ZXJzYXRpb24sXG4gICAgdG90YWw6IGNvbnZlcnNhdGlvbi5sZW5ndGhcbiAgfSk7XG59XG5cbi8qKlxuICogSGVhbHRoIGNoZWNrXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBIRUFEKCkge1xuICByZXR1cm4gbmV3IFJlc3BvbnNlKG51bGwsIHsgc3RhdHVzOiAyMDAgfSk7XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIkFQSV9LRVlTIiwicGVycGxleGl0eSIsInByb2Nlc3MiLCJlbnYiLCJQRVJQTEVYSVRZX0FQSV9LRVkiLCJ0YXZpbHkiLCJUQVZJTFlfQVBJX0tFWSIsIm9wZW5yb3V0ZXIiLCJPUEVOUk9VVEVSX0FQSV9LRVkiLCJicmF2ZSIsIkJSQVZFX0FQSV9LRVkiLCJvcGVuYWkiLCJPUEVOQUlfQVBJX0tFWSIsImFudGhyb3BpYyIsIkFOVEhST1BJQ19BUElfS0VZIiwic2Vzc2lvbnMiLCJNYXAiLCJTb3BoaWFDb3JlIiwiY2xhc3NpZnlRdWVyeSIsInF1ZXJ5IiwicSIsInRvTG93ZXJDYXNlIiwidGVzdCIsImNhbGxQZXJwbGV4aXR5IiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1vZGVsIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsIm9rIiwiZGF0YSIsImpzb24iLCJjaG9pY2VzIiwibWVzc2FnZSIsImUiLCJjb25zb2xlIiwiZXJyb3IiLCJjYWxsVGF2aWx5IiwiYXBpX2tleSIsInNlYXJjaF9kZXB0aCIsIm1heF9yZXN1bHRzIiwiYW5zd2VyIiwicmVzdWx0cyIsInJlc3VsdCIsImxlbmd0aCIsInNsaWNlIiwibWFwIiwiciIsInRpdGxlIiwidXJsIiwiam9pbiIsImNhbGxPcGVuUm91dGVyIiwiY2FsbE1DUCIsInR5cGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJzdW1tYXJ5IiwibWV0YWRhdGEiLCJzdGFycyIsInJlc2VhcmNoUmVzcG9uc2UiLCJnZW5lcmF0ZVJlc3BvbnNlIiwic2Vzc2lvbklkIiwicXVlcnlUeXBlIiwicHJvdmlkZXIiLCJnZXRGYWxsYmFja1Jlc3BvbnNlIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwicmVzcG9uc2VzIiwiY29kZSIsInJlc2VhcmNoIiwia25vd2xlZGdlIiwicGxhbm5pbmciLCJhbmFseXNpcyIsImdlbmVyYWwiLCJzb3BoaWEiLCJQT1NUIiwicmVxdWVzdCIsImNvbnRleHQiLCJzdGF0dXMiLCJoYXMiLCJzZXQiLCJjb252ZXJzYXRpb24iLCJnZXQiLCJwdXNoIiwic3BsaWNlIiwiY29udmVyc2F0aW9uTGVuZ3RoIiwiR0VUIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidG90YWwiLCJIRUFEIiwiUmVzcG9uc2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/chat/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Flynnmusil%2Fsophia-ai-intel-1%2Fapps%2Fsophia-dashboard%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flynnmusil%2Fsophia-ai-intel-1%2Fapps%2Fsophia-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();