"use strict";(()=>{var e={};e.id=996,e.ids=[996],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8749:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>_,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var s={};a.r(s),a.d(s,{GET:()=>c,POST:()=>l});var r=a(3036),o=a(5736),n=a(5262),i=a(942);let u=process.env.PROMETHEUS_URL||"http://localhost:9090";async function l(e){try{let t;let{query:a,start:s,end:r,step:o,time:n}=await e.json();if(!a)return i.NextResponse.json({error:"Query parameter is required"},{status:400});let l=new URLSearchParams;l.append("query",a),s&&r?(t=`${u}/api/v1/query_range`,l.append("start",s),l.append("end",r),o&&l.append("step",o)):(t=`${u}/api/v1/query`,n&&l.append("time",n));let c=await fetch(`${t}?${l.toString()}`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4)});if(!c.ok)throw Error(`Prometheus returned ${c.status}: ${c.statusText}`);let p=await c.json();if("error"===p.status)return i.NextResponse.json({error:p.error||"Query failed",errorType:p.errorType},{status:400});return i.NextResponse.json({status:"success",resultType:p.data?.resultType,results:p.data?.result||[]})}catch(t){if(console.error("Prometheus query error:",t),t instanceof Error&&(t.message.includes("ECONNREFUSED")||t.message.includes("fetch failed"))){let t=await e.json().catch(()=>({query:""}));return i.NextResponse.json({status:"fallback",message:"Prometheus unavailable, returning simulated metrics",results:function(e){let t=Date.now()/1e3;return e.includes("up")?[{metric:{job:"sophia-dashboard",instance:"localhost:3000"},value:[t,"1"]},{metric:{job:"sophia-agents",instance:"localhost:5001"},value:[t,"1"]},{metric:{job:"mcp-context",instance:"localhost:3002"},value:[t,"1"]},{metric:{job:"prometheus",instance:"localhost:9090"},value:[t,"0"]}]:e.includes("http_requests_total")?[{metric:{method:"GET",status:"200",endpoint:"/api/chat"},value:[t,"1543"]},{metric:{method:"POST",status:"200",endpoint:"/api/chat"},value:[t,"892"]},{metric:{method:"GET",status:"200",endpoint:"/api/health"},value:[t,"3421"]},{metric:{method:"GET",status:"404",endpoint:"/api/unknown"},value:[t,"23"]}]:e.includes("swarm_tasks_total")?[{metric:{swarm_type:"research",status:"completed"},value:[t,"45"]},{metric:{swarm_type:"planning",status:"completed"},value:[t,"38"]},{metric:{swarm_type:"coding",status:"completed"},value:[t,"52"]},{metric:{swarm_type:"research",status:"failed"},value:[t,"3"]}]:e.includes("llm_tokens_used_total")?[{metric:{model:"claude-3-sonnet",provider:"anthropic"},value:[t,"285943"]},{metric:{model:"gpt-4",provider:"openai"},value:[t,"194832"]},{metric:{model:"mixtral-8x7b",provider:"together"},value:[t,"423891"]}]:e.includes("process_resident_memory_bytes")?[{metric:{job:"sophia-dashboard"},value:[t,"134217728"]},{metric:{job:"sophia-agents"},value:[t,"268435456"]},{metric:{job:"mcp-context"},value:[t,"201326592"]}]:[{metric:{service:"sophia",type:"default"},value:[t,100*Math.random()+""]}]}(t.query||"")})}return i.NextResponse.json({error:t instanceof Error?t.message:"Failed to query Prometheus",status:"error"},{status:500})}}async function c(e){try{let{searchParams:t}=new URL(e.url),a=t.get("target");if("health"===a){let e=await fetch(`${u}/-/healthy`,{signal:AbortSignal.timeout(5e3)});return i.NextResponse.json({status:e.ok?"healthy":"unhealthy",prometheus_url:u,timestamp:new Date().toISOString()})}if("targets"===a){let e=await fetch(`${u}/api/v1/targets`,{headers:{Accept:"application/json"},signal:AbortSignal.timeout(5e3)});if(!e.ok)throw Error(`Failed to fetch targets: ${e.statusText}`);let t=await e.json();return i.NextResponse.json({status:"success",targets:t.data?.activeTargets||[],summary:{total:t.data?.activeTargets.length||0,up:t.data?.activeTargets.filter(e=>"up"===e.health).length||0,down:t.data?.activeTargets.filter(e=>"down"===e.health).length||0}})}let s=await fetch(`${u}/api/v1/label/__name__/values`,{headers:{Accept:"application/json"},signal:AbortSignal.timeout(5e3)});if(!s.ok)throw Error(`Failed to fetch metrics: ${s.statusText}`);let r=await s.json();return i.NextResponse.json({status:"success",metrics:r.data||[],total:r.data?.length||0,prometheus_url:u})}catch(e){return console.error("Prometheus GET error:",e),i.NextResponse.json({status:"fallback",message:"Prometheus unavailable",metrics:["up","http_requests_total","http_request_duration_seconds","process_cpu_seconds_total","process_resident_memory_bytes","nodejs_heap_size_total_bytes","swarm_tasks_total","swarm_active_agents","llm_tokens_used_total","llm_request_duration_seconds"],prometheus_url:u})}}let p=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/metrics/route",pathname:"/api/metrics",filename:"route",bundlePath:"app/api/metrics/route"},resolvedPagePath:"/Users/lynnmusil/sophia-ai-intel-1/apps/sophia-dashboard/src/app/api/metrics/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:h}=p,_="/api/metrics/route";function g(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[522,746],()=>a(8749));module.exports=s})();