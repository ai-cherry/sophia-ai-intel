<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Visual Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: white;
            padding: 20px;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 { margin-bottom: 30px; color: #00ffcc; }
        .test-frame {
            width: 100%;
            height: 800px;
            border: 2px solid #00ffcc;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .metric-card {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(0, 255, 204, 0.2);
            border-radius: 8px;
            padding: 15px;
        }
        .metric-label {
            color: #888;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ffcc;
        }
        .status { 
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px;
        }
        .status.good { background: #10b981; }
        .status.warning { background: #f59e0b; }
        .status.error { background: #ef4444; }
        .console-output {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .console-error { color: #ef4444; }
        .console-warn { color: #f59e0b; }
        .console-log { color: #888; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Sophia AI Dashboard - Visual Quality Test</h1>
        
        <div id="test-results"></div>
        
        <h2 style="margin: 20px 0; color: #9945ff;">Live Dashboard</h2>
        <iframe 
            id="dashboard-frame"
            src="http://localhost:3001/dashboard" 
            class="test-frame"
            onload="runTests()"
        ></iframe>
        
        <div class="metrics" id="metrics"></div>
        
        <div class="console-output" id="console"></div>
    </div>

    <script>
        let consoleLog = [];
        
        function log(message, type = 'log') {
            const time = new Date().toLocaleTimeString();
            consoleLog.push({ time, message, type });
            updateConsole();
        }
        
        function updateConsole() {
            const consoleEl = document.getElementById('console');
            consoleEl.innerHTML = consoleLog.map(entry => 
                `<div class="console-${entry.type}">[${entry.time}] ${entry.message}</div>`
            ).join('');
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }
        
        async function runTests() {
            log('Starting visual quality tests...', 'log');
            const frame = document.getElementById('dashboard-frame');
            const results = document.getElementById('test-results');
            const metrics = document.getElementById('metrics');
            
            try {
                // Wait for frame to load
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                const frameWin = frame.contentWindow;
                
                // Capture console errors from iframe
                frameWin.console.error = function(...args) {
                    log(`Dashboard Error: ${args.join(' ')}`, 'error');
                };
                
                // Test 1: Check if components exist
                const components = {
                    'Navigation Rail': frameDoc.querySelector('[class*="NavigationRail"], nav, [role="navigation"]'),
                    'Main Content': frameDoc.querySelector('main, [role="main"], .main-content'),
                    'Context Panel': frameDoc.querySelector('[class*="ContextPanel"], [class*="context"], aside'),
                    'Message Area': frameDoc.querySelector('[class*="message"], [class*="chat"]'),
                    'Input Field': frameDoc.querySelector('input[type="text"], textarea')
                };
                
                let componentStatus = '<div style="margin: 20px 0;">';
                componentStatus += '<h3 style="color: #00ffcc; margin-bottom: 10px;">Component Status:</h3>';
                
                let passCount = 0;
                let totalCount = Object.keys(components).length;
                
                for (const [name, element] of Object.entries(components)) {
                    if (element) {
                        componentStatus += `<span class="status good">‚úì ${name}</span>`;
                        passCount++;
                        log(`‚úì ${name} found`, 'log');
                    } else {
                        componentStatus += `<span class="status error">‚úó ${name}</span>`;
                        log(`‚úó ${name} not found`, 'error');
                    }
                }
                componentStatus += '</div>';
                
                // Test 2: Check layout
                const body = frameDoc.body;
                const computedStyle = frameWin.getComputedStyle(body);
                
                const layoutMetrics = {
                    'Body Width': body.clientWidth + 'px',
                    'Body Height': body.clientHeight + 'px',
                    'Background': computedStyle.background.substring(0, 50) + '...',
                    'Font Family': computedStyle.fontFamily.substring(0, 30),
                    'Components Found': `${passCount}/${totalCount}`,
                    'Score': Math.round((passCount / totalCount) * 100) + '%'
                };
                
                // Test 3: Check for errors
                const errors = frameDoc.querySelectorAll('.error, [class*="error"]');
                if (errors.length > 0) {
                    log(`Found ${errors.length} error elements`, 'warn');
                }
                
                // Test 4: Check animations/transitions
                const animatedElements = frameDoc.querySelectorAll('[class*="animate"], [style*="transition"]');
                log(`Found ${animatedElements.length} animated elements`, 'log');
                
                // Update metrics display
                metrics.innerHTML = Object.entries(layoutMetrics).map(([label, value]) => `
                    <div class="metric-card">
                        <div class="metric-label">${label}</div>
                        <div class="metric-value">${value}</div>
                    </div>
                `).join('');
                
                results.innerHTML = componentStatus;
                
                // Overall assessment
                const score = (passCount / totalCount) * 100;
                if (score === 100) {
                    log('‚ú® EXCELLENT - All components rendered correctly!', 'log');
                    results.innerHTML += '<div class="status good" style="font-size: 18px; margin-top: 20px;">‚ú® Visual Quality: EXCELLENT</div>';
                } else if (score >= 80) {
                    log('‚úì GOOD - Most components rendered', 'log');
                    results.innerHTML += '<div class="status warning" style="font-size: 18px; margin-top: 20px;">‚ö†Ô∏è Visual Quality: NEEDS IMPROVEMENT</div>';
                } else {
                    log('‚úó POOR - Many components missing', 'error');
                    results.innerHTML += '<div class="status error" style="font-size: 18px; margin-top: 20px;">‚ùå Visual Quality: POOR</div>';
                }
                
            } catch (error) {
                log(`Test failed: ${error.message}`, 'error');
                results.innerHTML = '<div class="status error">Test failed - check console</div>';
            }
        }
        
        // Auto-refresh every 10 seconds
        setInterval(() => {
            log('Refreshing dashboard...', 'log');
            document.getElementById('dashboard-frame').src = 'http://localhost:3001/dashboard';
        }, 30000);
    </script>
</body>
</html>