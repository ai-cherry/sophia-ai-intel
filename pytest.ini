[pytest]
# Pytest configuration for Sophia AI Intel comprehensive testing

# Minimum pytest version
minversion = 6.0

# Test discovery patterns
python_files = test_*.py *_test.py tests.py
python_classes = Test* *Tests
python_functions = test_*

# Test paths
testpaths = 
    tests
    services/*/tests
    apps/*/tests
    mcp/*/tests
    agents/*/tests

# Add project root to Python path
pythonpath = 
    .
    services
    apps
    mcp
    agents
    libs

# Markers for categorizing tests
markers =
    unit: Unit tests
    integration: Integration tests  
    e2e: End-to-end tests
    slow: Slow running tests
    redis: Tests requiring Redis
    postgres: Tests requiring PostgreSQL
    qdrant: Tests requiring Qdrant vector database
    external_api: Tests requiring external API access
    mcp: MCP service tests
    agents: Agent system tests
    frontend: Frontend application tests
    monitoring: Monitoring and observability tests
    memory: Memory service tests
    auth: Authentication tests
    api: API endpoint tests
    performance: Performance tests
    security: Security tests
    smoke: Smoke tests for basic functionality

# Output options
addopts = 
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --color=yes
    --durations=10
    --maxfail=5
    --html=reports/pytest-report.html
    --self-contained-html
    --junitxml=reports/pytest-junit.xml
    --cov=services
    --cov=apps
    --cov=mcp
    --cov=agents
    --cov=libs
    --cov-report=html:reports/coverage-html
    --cov-report=xml:reports/coverage.xml
    --cov-report=term-missing
    --cov-fail-under=70

# Logging configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Test timeout (in seconds)
timeout = 300

# Ignore patterns
ignore_glob = 
    **/node_modules/**
    **/.next/**
    **/__pycache__/**
    **/dist/**
    **/build/**

# Warnings filters
filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    error::FutureWarning

# Asyncio configuration
asyncio_mode = auto

# Environment variables for testing
env = 
    TESTING = 1
    ENVIRONMENT = test
    LOG_LEVEL = DEBUG
    POSTGRES_URL = postgresql://sophia_test:sophia_test_password_123@localhost:5433/sophia_test
    REDIS_URL = redis://localhost:6380/1
    QDRANT_URL = http://localhost:6334
    MOCK_EXTERNAL_APIS = true
    DISABLE_AUTH = false