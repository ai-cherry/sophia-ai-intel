{
  "timestamp": "2025-08-22T21:41:30Z",
  "status": "preflight_passed",
  "task": "preflight_envmap",
  "query": "verify_secrets_mapping_and_deploy_workflow",
  
  "secrets_map_validation": {
    "file": ".infra/secrets_map.json",
    "status": "✅ complete_mapping_found",
    "critical_secrets_mapped": {
      "QDRANT_URL": "✅ mapped for research + business services",
      "REDIS_URL": "✅ mapped for research + business services", 
      "NEON_DATABASE_URL": "✅ mapped for business + context services"
    },
    "deployment_targets_verified": {
      "sophiaai-mcp-research-v2": ["PORTKEY_API_KEY", "TAVILY_API_KEY", "SERPER_API_KEY", "QDRANT_URL", "REDIS_URL"],
      "sophiaai-mcp-business-v2": ["NEON_DATABASE_URL", "PORTKEY_API_KEY", "QDRANT_URL", "REDIS_URL", "TELEGRAM_BOT_TOKEN", "TELEGRAM_CHAT_ID"],
      "sophiaai-mcp-context-v2": ["NEON_DATABASE_URL", "QDRANT_URL", "REDIS_URL"],
      "sophiaai-mcp-repo-v2": ["GITHUB_APP_ID", "GITHUB_INSTALLATION_ID", "GITHUB_PRIVATE_KEY"],
      "sophiaai-dashboard-v2": ["VITE_BUILD_ID", "VITE_GIT_COMMIT"]
    }
  },
  
  "deploy_workflow_validation": {
    "file": ".github/workflows/deploy_all.yml",
    "status": "✅ correctly_configured",
    "fly_token": "✅ FLY_TOKEN_PAY_READY (lines 47, 67, 187)",
    "fly_org": "✅ pay-ready (lines 36, 68, 188)", 
    "canonical_naming": "✅ all apps use -v2 suffix",
    "qdrant_secret": "✅ QDRANT_URL used (lines 264, 307) - bug fixed",
    "secret_mapping_verified": {
      "research_service": "✅ TAVILY_API_KEY, SERPER_API_KEY, PORTKEY_API_KEY, REDIS_URL",
      "business_service": "✅ NEON_DATABASE_URL, PORTKEY_API_KEY, REDIS_URL, QDRANT_URL",
      "context_service": "✅ NEON_DATABASE_URL"
    }
  },
  
  "app_names_canonical": {
    "dashboard": "sophiaai-dashboard-v2",
    "mcp_repo": "sophiaai-mcp-repo-v2", 
    "mcp_research": "sophiaai-mcp-research-v2",
    "mcp_context": "sophiaai-mcp-context-v2",
    "mcp_business": "sophiaai-mcp-business-v2"
  },
  
  "readiness_summary": {
    "secrets_mapping": "✅ complete",
    "deploy_workflow": "✅ configured_for_pay_ready_org",
    "canonical_naming": "✅ all_apps_v2_suffix",
    "infrastructure_secrets": "✅ qdrant_redis_neon_mapped",
    "ready_for_deploy": "✅ all_validations_passed"
  }
}